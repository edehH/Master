<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠ</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,sans-serif;background:#0a0a1a;color:#fff;min-height:100vh}
    
    /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ --- */
    .app{display:flex;min-height:100vh}
    
    /* Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± (ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¬ÙˆØ§Ù„) */
    .sidebar{
      width:280px;
      background:rgba(255,255,255,.05);
      border-left:1px solid rgba(255,255,255,.1);
      padding:20px;
      position:fixed;
      height:100vh;
      overflow-y:auto;
      z-index: 1000;
      transition: transform 0.3s ease;
    }
    
    .main{flex:1;margin-right:280px;padding:20px; transition: margin-right 0.3s ease;}

    /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ø¬ÙˆØ§Ù„ (Ø¬Ø¯ÙŠØ¯) */
    .mobile-header {
      display: none;
      background: #1a1a2e;
      padding: 15px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      position: sticky;
      top: 0;
      z-index: 999;
      justify-content: space-between;
      align-items: center;
    }
    .menu-toggle {
      background: none;
      border: none;
      color: #0ff;
      font-size: 24px;
      cursor: pointer;
    }

    /* --- Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© --- */
    .logo{font-size:22px;font-weight:900;margin-bottom:20px;color:#0ff}
    .menu{display:flex;flex-direction:column;gap:8px}
    .menu button{width:100%;padding:14px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:#fff;border-radius:10px;cursor:pointer;font-size:14px;font-weight:700;text-align:right;transition:.2s}
    .menu button:hover{background:rgba(255,255,255,.08);transform:translateY(-2px)}
    .menu button.active{background:linear-gradient(135deg,rgba(0,255,255,.15),rgba(139,92,255,.15));border-color:#0ff}
    .menu button.locked{border-color:#f90;background:rgba(255,153,0,.1)}
    
    .card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:20px;margin-bottom:16px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    
    /* Ø§Ù„Ø´Ø¨ÙƒØ§Øª (Grids) */
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    
    h2{margin-bottom:16px;font-size:20px}
    h3{margin-bottom:12px}
    input,select{width:100%;padding:12px;border:1px solid rgba(255,255,255,.15);background:rgba(0,0,0,.3);color:#fff;border-radius:8px;font-size:14px}
    input:focus,select:focus{outline:none;border-color:#0ff}
    label{display:block;margin-bottom:6px;font-size:12px;color:rgba(255,255,255,.7)}
    
    .btn{padding:12px 20px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.05);color:#fff;border-radius:8px;cursor:pointer;font-weight:700;transition:.2s}
    .btn:hover{background:rgba(255,255,255,.1);transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg,#8b5cf6,#0ff);border:none}
    .btn.danger{background:#f43f5e;border:none}
    .btn.warning{background:#f90;border:none;color:#000} /* ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© warning */
    .btn.sm{padding:8px 14px;font-size:12px}
    
    .hidden{display:none!important}
    .view{display:none}
    .view.active{display:block}
    
    .stat{text-align:center;padding:20px}
    .stat .num{font-size:32px;font-weight:900;color:#0ff}
    .stat .lbl{font-size:12px;color:rgba(255,255,255,.6);margin-top:4px}
    
    /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
    .table-wrapper {width:100%; overflow-x: auto;} /* Ø­Ø§ÙˆÙŠØ© Ù„Ù„ØªÙ…Ø±ÙŠØ± */
    table{width:100%;border-collapse:collapse; min-width: 600px;} /* Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹Ø±Ø¶ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ´ÙˆÙ‡ */
    th,td{padding:12px;text-align:right;border-bottom:1px solid rgba(255,255,255,.08)}
    th{background:rgba(0,0,0,.2);font-size:12px}
    
    .toast-box{position:fixed;bottom:20px;left:20px;right:20px;z-index:9999;pointer-events:none}
    .toast{background:#22c55e;color:#fff;padding:14px;border-radius:10px;margin-top:8px;font-weight:700;pointer-events:none}
    .toast.err{background:#f43f5e}
    
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:9998;padding:20px}
    .modal{background:#1a1a2e;border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:24px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto}
    
    .invoice-white{background:#fff;color:#222;padding:24px;border-radius:12px;font-family:'Courier New',monospace}
    .invoice-white h2{text-align:center;border-bottom:2px solid #222;padding-bottom:10px;color:#222}
    .invoice-white .meta{text-align:center;color:#666;font-size:12px;margin:10px 0}
    .invoice-white .items{margin:16px 0}
    .invoice-white .item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #ccc}
    .invoice-white .total{font-size:18px;font-weight:bold;text-align:left;margin-top:12px;padding-top:12px;border-top:2px solid #222}
    .invoice-white .footer{text-align:center;margin-top:16px;font-size:11px;color:#888}
    
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(0,0,0,.2);border-radius:8px;margin-bottom:8px}
    .low-stock{color:#f90;font-weight:bold}

    /* Analytics Styles */
    .time-filter{display:flex;gap:8px;flex-wrap:wrap}
    .time-filter button{padding:8px 14px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.05);color:#fff;border-radius:999px;cursor:pointer;font-size:12px;transition:.2s}
    .time-filter button:hover,.time-filter button.active{background:linear-gradient(135deg,#8b5cf6,#0ff);border-color:transparent}

    .stat-card{background:linear-gradient(135deg,rgba(255,255,255,.08),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:18px;text-align:center}
    .stat-card .v{font-size:26px;font-weight:900;margin-top:8px}
    .stat-card .l{font-size:12px;color:rgba(255,255,255,.6);margin-top:4px}
    .v.green{color:#22c55e}
    .v.yellow{color:#fbbf24}
    .v.red{color:#f43f5e}
    .v.cyan{color:#0ff}

    .chart-wrap{background:linear-gradient(180deg,rgba(10,10,26,.9),rgba(20,20,40,.95));border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:18px;margin-top:16px}
    .chart-head{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:10px}
    .legend{display:flex;gap:10px;flex-wrap:wrap}
    .legend span{display:flex;align-items:center;gap:8px;font-size:12px;padding:6px 10px;background:rgba(255,255,255,.05);border-radius:999px}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.g{background:#22c55e}
    .dot.y{background:#fbbf24}
    .dot.r{background:#f43f5e}
    canvas{width:100%;height:320px;background:rgba(0,0,0,.25);border-radius:14px;display:block}

    /* --- Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (Responsive) --- */
    @media(max-width:1200px){.grid4{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:768px){
      .sidebar{transform:translateX(100%); width: 260px;} /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
      .sidebar.open{transform:translateX(0)} /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
      .main{margin-right:0}
      .mobile-header{display:flex} /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± */
      .grid4,.grid3,.grid2{grid-template-columns:1fr} /* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ù„Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ */
    }
  </style>
</head>
<body>

<div class="toast-box" id="toasts"></div>

<div class="mobile-header">
  <div class="logo" style="margin:0; font-size:18px">ğŸª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠ</div>
  <button class="menu-toggle" id="toggleBtn">â˜°</button>
</div>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="logo">ğŸª Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
    <nav class="menu" id="menu">
      <button data-v="dashboard" class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button data-v="products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
      <button data-v="customers">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
      <button data-v="scan">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</button>
      <button data-v="debts">Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</button>
      <button data-v="invoices">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
      <button data-v="analytics" class="locked">ğŸ”’ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</button>
      <button data-v="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </nav>
    <div style="margin-top:auto;padding-top:20px;border-top:1px solid rgba(255,255,255,.1)">
      <div style="font-size:12px;color:rgba(255,255,255,.5)" id="userInfo">ØºÙŠØ± Ù…Ø³Ø¬Ù„</div>
      <button class="btn sm" style="width:100%;margin-top:10px" id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
    </div>
  </aside>

  <main class="main" id="mainContent">

    <div class="view active" id="v-login">
      <div class="card" style="max-width:400px;margin:60px auto">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div style="margin-bottom:12px"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label><input id="inUser" value="admin"></div>
        <div style="margin-bottom:12px"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input id="inPass" type="password" value="admin123"></div>
        <div class="row">
          <button class="btn primary" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
        </div>
      </div>
    </div>

    <div class="view" id="v-dashboard">
      <h2>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
      <div class="grid2">
        <div class="card stat"><div class="num" id="dSales">0</div><div class="lbl">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div></div>
        <div class="card stat"><div class="num" id="dCount">0</div><div class="lbl">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div></div>
      </div>
      <div class="card stat"><div class="num" id="dLow">0</div><div class="lbl">Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆØ´ÙƒØª Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙØ§Ø¯</div></div>
    </div>

    <div class="view" id="v-products">
      <div class="row" style="margin-bottom:16px"><h2 style="margin:0">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2><button class="btn primary sm" id="addProdBtn">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button></div>
      <div class="card table-wrapper">
        <table>
          <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>SKU</th><th>Ø´Ø±Ø§Ø¡</th><th>Ø¨ÙŠØ¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
          <tbody id="prodTable"></tbody>
        </table>
      </div>
    </div>

    <div class="view" id="v-customers">
      <div class="row" style="margin-bottom:16px"><h2 style="margin:0">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2><button class="btn primary sm" id="addCustBtn">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button></div>
      <div class="card table-wrapper">
        <table>
          <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
          <tbody id="custTable"></tbody>
        </table>
      </div>
    </div>

    <div class="view" id="v-scan">
      <h2>Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h2>
      <div class="grid2">
        <div class="card">
          <div style="margin-bottom:12px"><label>ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ (QR/SKU)</label><input id="scanCode" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ø¶ØºØ· Enter"></div>
          <div style="margin-bottom:12px"><label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
            <select id="payMethod">
              <option value="cash">ÙƒØ§Ø´ (Ù†Ù‚Ø¯ÙŠ)</option>
              <option value="bankily">Ø¨Ù†ÙƒÙŠÙ„ÙŠ (Bankily)</option>
              <option value="masrvi">Ù…ØµØ±ÙÙŠ (Masrvi)</option>
              <option value="sadad">Ø³Ø¯Ø§Ø¯ (Sadad)</option>
              <option value="bimpay">Ø¨ÙŠÙ… Ø¨Ø¢ÙŠ (BimPay)</option>
              <option value="click">ÙƒÙ„ÙŠÙƒ (Click)</option>
              <option value="gazapay">ØºØ²Ø© Ø¨ÙŠ (Gaza Pay)</option>
              <option value="debt">Ø¯ÙŠÙ† (Ù…Ø¤Ø¬Ù„)</option>
            </select>
          </div>
          <div style="margin-bottom:12px"><label>Ø§Ù„Ø¹Ù…ÙŠÙ„ (ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø¯ÙŠÙ† Ø£Ùˆ Ø§Ù„ØªØ­ÙˆÙŠÙ„)</label><select id="custSelect"><option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ â€”</option></select></div>
          <div class="row"><button class="btn primary" id="addToCartBtn">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button><button class="btn" id="clearCartBtn">ØªÙØ±ÙŠØº</button></div>
        </div>
        <div class="card">
          <h3>Ø§Ù„Ø³Ù„Ø©</h3>
          <div id="cartItems"></div>
          <div style="font-size:20px;font-weight:900;margin-top:12px">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cartTotal">0.00</span></div>
          <button class="btn primary" style="width:100%;margin-top:12px" id="confirmSaleBtn">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹</button>
        </div>
      </div>
    </div>

    <div class="view" id="v-debts">
      <h2>Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</h2>
      <div class="card table-wrapper">
        <table>
          <thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
          <tbody id="debtTable"></tbody>
        </table>
      </div>
    </div>

    <div class="view" id="v-invoices">
      <h2>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
      <div class="card table-wrapper">
        <table>
          <thead><tr><th>Ø±Ù‚Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„Ø¯ÙØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
          <tbody id="invTable"></tbody>
        </table>
      </div>
    </div>

    <div class="view" id="v-analytics">
      <h2>ğŸ”’ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</h2>

      <div id="analyticsLock" class="card" style="text-align:center;padding:40px">
        <p style="margin-bottom:16px">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„ÙˆØµÙˆÙ„:</p>
        <input id="analyticsCode" type="password" placeholder="****" style="max-width:220px;text-align:center;font-size:24px;letter-spacing:8px">
        <button class="btn primary" style="margin-top:16px" id="unlockAnalyticsBtn">ÙØªØ­</button>
      </div>

      <div id="analyticsContent" class="hidden">

        <div class="card">
          <div class="row" style="justify-content:space-between">
            <h3 style="margin:0">Ø§Ù„ÙØªØ±Ø©</h3>
            <div class="time-filter" id="periodBtns">
              <button class="active" data-period="7">7 Ø£ÙŠØ§Ù…</button>
              <button data-period="14">14 ÙŠÙˆÙ…</button>
              <button data-period="30">30 ÙŠÙˆÙ…</button>
            </div>
          </div>
        </div>

        <div class="grid4">
          <div class="stat-card">
            <div class="l">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø§Ù„ÙØªØ±Ø©)</div>
            <div class="v green" id="aProfit">0.00</div>
          </div>
          <div class="stat-card">
            <div class="l">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø§Ù„ÙØªØ±Ø©)</div>
            <div class="v yellow" id="aSales">0.00</div>
          </div>
          <div class="stat-card">
            <div class="l">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div>
            <div class="v cyan" id="aInvCount">0</div>
          </div>
          <div class="stat-card">
            <div class="l">Ø£ÙˆØ´ÙƒØª Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙØ§Ø¯</div>
            <div class="v red" id="aLowCount">0</div>
          </div>
        </div>

        <div class="chart-wrap">
          <div class="chart-head">
            <div style="font-weight:900">ğŸ“ˆ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ (ØµØ¹ÙˆØ¯/Ù†Ø²ÙˆÙ„)</div>
            <div class="legend">
              <span><i class="dot g"></i> Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</span>
              <span><i class="dot y"></i> Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
              <span><i class="dot r"></i> Ù†Ù‚Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
            </div>
          </div>
          <canvas id="analyticsChart" width="1200" height="320"></canvas>
          <div style="margin-top:10px;font-size:12px;color:rgba(255,255,255,.55)">
            * Ø§Ù„Ø£Ø®Ø¶Ø± = Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ØŒ Ø§Ù„Ø£ØµÙØ± = Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŒ Ø§Ù„Ø£Ø­Ù…Ø± = Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªØ­Øª Ø­Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡.
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <h3>ğŸ“‰ Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆØ´ÙƒØª Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙØ§Ø¯</h3>
          <div id="lowStockList"></div>
        </div>

        <div class="card" style="margin-top:16px">
          <h3>ğŸ“Š Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
          <div id="activityList"></div>
        </div>

      </div>
    </div>

    <div class="view" id="v-settings">
      <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
      <div class="card"><button class="btn danger" id="resetBtn">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button></div>
    </div>

  </main>
</div>

<script>
(function(){
  const KEY = "pos_data_v5";
  let S = {user:null,products:[],customers:[],invoices:[],debts:[],cart:[]};
  let analyticsDays = 7;

  const $=s=>document.querySelector(s);
  const $$=s=>[...document.querySelectorAll(s)];

  function save(){localStorage.setItem(KEY,JSON.stringify(S))}
  function load(){try{const d=JSON.parse(localStorage.getItem(KEY));if(d)S=d}catch{}}

  function toast(m,e){
    const t=document.createElement("div");
    t.className="toast"+(e?" err":"");
    t.textContent=m;
    $("#toasts").appendChild(t);
    setTimeout(()=>t.remove(),3000)
  }

  function money(n){return Number(n||0).toFixed(2)}

  // Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
  $("#toggleBtn").addEventListener("click", () => {
    $("#sidebar").classList.toggle("open");
  });

  function showView(v){
    $$(".view").forEach(el=>el.classList.remove("active"));
    const el=$("#v-"+v); if(el) el.classList.add("active");
    $$(".menu button").forEach(b=>b.classList.toggle("active",b.dataset.v===v));
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    $("#sidebar").classList.remove("open");

    if(v==="dashboard")renderDash();
    if(v==="products")renderProds();
    if(v==="customers")renderCusts();
    if(v==="scan")renderScan();
    if(v==="debts")renderDebts();
    if(v==="invoices")renderInvs();
    if(v==="analytics"){
      $("#analyticsLock").classList.remove("hidden");
      $("#analyticsContent").classList.add("hidden");
    }
  }

  function renderDash(){
    const today=new Date().toDateString();
    const todayInvs=S.invoices.filter(i=>new Date(i.date).toDateString()===today);
    const total=todayInvs.reduce((s,i)=>s+i.total,0);
    $("#dSales").textContent=money(total);
    $("#dCount").textContent=todayInvs.length;
    $("#dLow").textContent=S.products.filter(p=>p.qty<=p.low).length;
  }

  function renderProds(){
    $("#prodTable").innerHTML=S.products.map(p=>`<tr>
      <td>${p.name}</td><td>${p.sku}</td><td>${money(p.buy)}</td><td>${money(p.sell)}</td>
      <td class="${p.qty<=p.low?"low-stock":""}">${p.qty}</td>
      <td class="row" style="flex-wrap:nowrap">
        <button class="btn sm warning" onclick="editProd(${p.id})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn sm danger" onclick="deleteProd(${p.id})">Ø­Ø°Ù</button>
      </td>
    </tr>`).join("")||"<tr><td colspan='6'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>";
  }

  window.editProd=function(id){
    const p=S.products.find(x=>x.id===id); if(!p) return;
    const name=prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:", p.name); if(name===null) return;
    const sku=prompt("ØªØ¹Ø¯ÙŠÙ„ SKU:", p.sku);
    const buy=Number(prompt("ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:", p.buy));
    const sell=Number(prompt("ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹:", p.sell));
    const qty=Number(prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©:", p.qty));
    const low=Number(prompt("Ø­Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:", p.low));
    
    Object.assign(p, {name, sku, buy, sell, qty, low});
    save(); renderProds(); toast("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
  }

  window.deleteProd=function(id){
    if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){
      S.products=S.products.filter(x=>x.id!==id);
      save();renderProds()
    }
  };

  function renderCusts(){
    $("#custTable").innerHTML=S.customers.map(c=>`<tr>
      <td>${c.name}</td><td>${c.phone||'---'}</td>
      <td class="row" style="flex-wrap:nowrap">
        <button class="btn sm warning" onclick="editCust(${c.id})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn sm danger" onclick="deleteCust(${c.id})">Ø­Ø°Ù</button>
      </td>
    </tr>`).join("")||"<tr><td colspan='3'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</td></tr>";
  }

  window.editCust=function(id){
    const c=S.customers.find(x=>x.id===id); if(!c) return;
    const name=prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:", c.name); if(name===null) return;
    const phone=prompt("ØªØ¹Ø¯ÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:", c.phone);
    
    Object.assign(c, {name, phone});
    save(); renderCusts(); toast("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
  }

  window.deleteCust=function(id){
    if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")){
      S.customers=S.customers.filter(x=>x.id!==id);
      save();renderCusts()
    }
  };

  function renderScan(){
    $("#custSelect").innerHTML=`<option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ â€”</option>`+S.customers.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
    renderCart();
  }

  function renderCart(){
    $("#cartItems").innerHTML=S.cart.map((it,i)=>`<div class="cart-item">
      <div><b>${it.name}</b><br><small>${it.qty} Ã— ${money(it.sell)}</small></div>
      <div><button class="btn sm" onclick="removeCart(${i})">Ø­Ø°Ù</button></div>
    </div>`).join("")||"<p style='color:rgba(255,255,255,.5)'>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>";
    $("#cartTotal").textContent=money(S.cart.reduce((s,it)=>s+it.qty*it.sell,0));
  }

  window.removeCart=function(i){S.cart.splice(i,1);save();renderCart()};

  function addToCart(){
    const code=$("#scanCode").value.trim().toUpperCase();
    if(!code)return toast("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯",true);
    const p=S.products.find(x=>String(x.sku||"").toUpperCase()===code);
    if(!p)return toast("Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯",true);
    if(p.qty<1)return toast("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ…ÙŠØ©",true);

    const ex=S.cart.find(x=>x.id===p.id);
    if(ex){ if(ex.qty>=p.qty) return toast("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ©",true); ex.qty++; }
    else S.cart.push({id:p.id,name:p.name,qty:1,sell:p.sell,buy:p.buy});

    $("#scanCode").value="";
    save();renderCart();toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
  }

  function confirmSale(){
    if(!S.cart.length)return toast("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©",true);
    const pay=$("#payMethod").value;
    const cust=$("#custSelect").value;

    if(pay !== "cash" && !cust) return toast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", true);

    const total=S.cart.reduce((s,it)=>s+it.qty*it.sell,0);
    const profit=S.cart.reduce((s,it)=>s+(it.sell-it.buy)*it.qty,0);

    S.cart.forEach(it=>{
      const p=S.products.find(x=>x.id===it.id);
      if(p) p.qty-=it.qty
    });

    const inv={id:Date.now(),date:new Date().toISOString(),items:[...S.cart],total,profit,pay,cust:cust||null};
    S.invoices.unshift(inv);

    if(pay==="debt"){
      const c=S.customers.find(x=>x.id==cust);
      S.debts.unshift({id:Date.now(),cust:c?c.name:"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",amount:total,remaining:total,ref:inv.id});
    }

    S.cart=[];
    save();
    showInvoiceModal(inv);
    renderCart();renderDash();
    toast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­");
  }

  function showInvoiceModal(inv){
    const c=S.customers.find(x=>x.id==inv.cust);
    const d=new Date(inv.date);
    const dateStr=d.toLocaleDateString("ar-SA")+" "+d.toLocaleTimeString("ar-SA");
    const html=`<div class="modal-bg" onclick="if(event.target===this)this.remove()">
      <div class="modal">
        <div class="invoice-white">
          <h2>ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
          <div class="meta">Ø±Ù‚Ù…: ${inv.id}<br>${dateStr}</div>
          <div class="items">${inv.items.map(it=>`<div class="item"><span>${it.name} Ã— ${it.qty}</span><span>${money(it.qty*it.sell)}</span></div>`).join("")}</div>
          <div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${money(inv.total)} MRU</div>
          <div class="meta">Ø§Ù„Ø¯ÙØ¹: ${inv.pay}${c?" | Ø§Ù„Ø¹Ù…ÙŠÙ„: "+c.name:""}</div>
          <div class="footer">Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§ â¤ï¸</div>
        </div>
        <div style="text-align:center;margin-top:16px">
          <button class="btn" onclick="this.closest('.modal-bg').remove()">Ø¥ØºÙ„Ø§Ù‚</button>
          <button class="btn primary" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø©</button>
        </div>
      </div>
    </div>`;
    document.body.insertAdjacentHTML("beforeend",html);
  }

  function renderDebts(){
    $("#debtTable").innerHTML=S.debts.map(d=>`<tr>
      <td>${d.cust}</td><td>${money(d.amount)}</td><td>${money(d.remaining)}</td>
      <td>${d.remaining<=0?"Ù…Ø³Ø¯Ø¯":"Ù…ÙØªÙˆØ­"}</td>
      <td class="row" style="flex-wrap:nowrap">
        <button class="btn sm warning" onclick="editDebt(${d.id})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn sm" onclick="payDebt(${d.id})">Ø³Ø¯Ø§Ø¯</button>
      </td>
    </tr>`).join("")||"<tr><td colspan='5'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ†</td></tr>";
  }

  window.editDebt=function(id){
    const d=S.debts.find(x=>x.id===id); if(!d) return;
    const amount=Number(prompt("ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙ†:", d.amount)); if(isNaN(amount)) return;
    const remaining=Number(prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:", d.remaining));
    
    Object.assign(d, {amount, remaining});
    save(); renderDebts(); toast("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
  }

  window.payDebt=function(id){
    const d=S.debts.find(x=>x.id===id); if(!d) return;
    const a=prompt("Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯:",d.remaining);
    if(a!==null){
      d.remaining=Math.max(0,d.remaining-Number(a));
      save();renderDebts();toast("ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯")
    }
  };

  function renderInvs(){
    $("#invTable").innerHTML=S.invoices.map(i=>`<tr>
      <td>${i.id}</td><td>${new Date(i.date).toLocaleDateString("ar-SA")}</td>
      <td>${money(i.total)}</td><td>${i.pay}</td>
      <td><button class="btn sm" onclick="viewInv(${i.id})">Ø¹Ø±Ø¶</button></td>
    </tr>`).join("")||"<tr><td colspan='5'>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ±</td></tr>";
  }

  window.viewInv=function(id){
    const inv=S.invoices.find(x=>x.id===id);
    if(inv)showInvoiceModal(inv);
  };

  function unlockAnalytics(){
  if($("#analyticsCode").value==="2220"){
      $("#analyticsLock").classList.add("hidden");
      $("#analyticsContent").classList.remove("hidden");
      renderAnalytics();
      toast("ØªÙ… ÙØªØ­ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø´Ø§Ø·");
    } else {
      toast("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­",true);
    }
  }

  function getLastNDaysLabels(n){
    const labels=[];
    const now=new Date();
    for(let i=n-1;i>=0;i--){
      const d=new Date(now);
      d.setDate(d.getDate()-i);
      labels.push(d);
    }
    return labels;
  }

  function sumInvoicesForDate(d){
    const ds=d.toDateString();
    const invs=S.invoices.filter(i=>new Date(i.date).toDateString()===ds);
    const sales=invs.reduce((s,i)=>s+i.total,0);
    const profit=invs.reduce((s,i)=>s+(i.profit||0),0);
    return {sales,profit,count:invs.length};
  }

  function drawLineChart(canvas, series, labels){
    const ctx=canvas.getContext("2d");
    const W=canvas.clientWidth || canvas.width;
    const H=320;

    const dpr=window.devicePixelRatio||1;
    canvas.width=Math.floor(W*dpr);
    canvas.height=Math.floor(H*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const w=W, h=H;
    const pad={l:55,r:18,t:18,b:38};
    const cw=w-pad.l-pad.r;
    const ch=h-pad.t-pad.b;

    ctx.clearRect(0,0,w,h);

    ctx.strokeStyle="rgba(255,255,255,.08)";
    ctx.lineWidth=1;
    for(let i=0;i<=5;i++){
      const y=pad.t+(ch/5)*i;
      ctx.beginPath();
      ctx.moveTo(pad.l,y);
      ctx.lineTo(w-pad.r,y);
      ctx.stroke();
    }

    const allVals=series.flatMap(s=>s.data);
    const max=Math.max(...allVals, 1);
    const min=Math.min(...allVals, 0);

    const xAt=i=>pad.l + (cw/(labels.length-1 || 1))*i;
    const yAt=v=>{
      const t=(v-min)/(max-min || 1);
      return pad.t + ch - t*ch;
    };

    ctx.fillStyle="rgba(255,255,255,.5)";
    ctx.font="11px system-ui";
    ctx.textAlign="right";
    ctx.fillText(String(max.toFixed(0)), pad.l-8, pad.t+10);
    ctx.fillText(String(min.toFixed(0)), pad.l-8, pad.t+ch);

    ctx.textAlign="center";
    labels.forEach((d,i)=>{
      const x=xAt(i);
      const txt=(d.getDate())+"/"+(d.getMonth()+1);
      ctx.fillText(txt, x, h-14);
    });

    series.forEach(s=>{
      ctx.beginPath();
      s.data.forEach((v,i)=>{
        const x=xAt(i), y=yAt(v);
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      });
      ctx.strokeStyle=s.color;
      ctx.lineWidth=3;
      ctx.lineJoin="round";
      ctx.lineCap="round";
      ctx.shadowColor=s.color;
      ctx.shadowBlur=10;
      ctx.stroke();
      ctx.shadowBlur=0;

      s.data.forEach((v,i)=>{
        const x=xAt(i), y=yAt(v);
        ctx.beginPath();
        ctx.arc(x,y,4,0,Math.PI*2);
        ctx.fillStyle=s.color;
        ctx.fill();
        ctx.strokeStyle="#0a0a1a";
        ctx.lineWidth=2;
        ctx.stroke();
      });
    });
  }

  function renderAnalytics(){
    const labels=getLastNDaysLabels(analyticsDays);
    const salesData=[];
    const profitData=[];
    const lowData=[];

    labels.forEach(d=>{
      const {sales,profit}=sumInvoicesForDate(d);
      salesData.push(sales);
      profitData.push(profit);
      lowData.push(S.products.filter(p=>p.qty<=p.low).length);
    });

    const rangeInvs=S.invoices.filter(i=>{
      const dd=new Date(i.date);
      return dd>=labels[0] && dd<=labels[labels.length-1];
    });

    const totalSales=rangeInvs.reduce((s,i)=>s+i.total,0);
    const totalProfit=rangeInvs.reduce((s,i)=>s+(i.profit||0),0);

    $("#aSales").textContent=money(totalSales);
    $("#aProfit").textContent=money(totalProfit);
    $("#aInvCount").textContent=rangeInvs.length;
    $("#aLowCount").textContent=S.products.filter(p=>p.qty<=p.low).length;

    const lowStock=S.products.filter(p=>p.qty<=p.low);
    $("#lowStockList").innerHTML=lowStock.length
      ? lowStock.map(p=>`<div class="cart-item"><span>${p.name}</span><span class="low-stock">Ù…ØªØ¨Ù‚ÙŠ: ${p.qty}</span></div>`).join("")
      : "<p style='color:#22c55e'>âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ©</p>";

    const todayStr=new Date().toDateString();
    const todayInvs=S.invoices.filter(i=>new Date(i.date).toDateString()===todayStr);
    $("#activityList").innerHTML=todayInvs.length
      ? todayInvs.slice(0,20).map(i=>`<div class="cart-item">
          <div><b>ÙØ§ØªÙˆØ±Ø© #${i.id}</b><br><small>${i.items.map(x=>x.name+"Ã—"+x.qty).join(", ")}</small></div>
          <div style="text-align:left"><b>${money(i.total)}</b><br><small style="color:#22c55e">Ø±Ø¨Ø­: ${money(i.profit||0)}</small></div>
        </div>`).join("")
      : "<p style='color:rgba(255,255,255,.5)'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>";

    const canvas=$("#analyticsChart");
    drawLineChart(canvas, [
      {name:"Ø§Ù„Ø£Ø±Ø¨Ø§Ø­", color:"#22c55e", data:profitData},
      {name:"Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", color:"#fbbf24", data:salesData},
      {name:"Ù†Ù‚Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†", color:"#f43f5e", data:lowData}
    ], labels);
  }

  function login(){
    const u=$("#inUser").value.trim();
    const p=$("#inPass").value;
    if(u==="admin"&&p==="admin123"){
      S.user={name:u};save();
      $("#userInfo").textContent="Ù…Ø±Ø­Ø¨Ø§Ù‹ "+u;
      showView("dashboard");
      toast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    } else {
      toast("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©",true);
    }
  }

  function logout(){
    S.user=null;S.cart=[];save();
    $("#userInfo").textContent="ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    showView("login");
    toast("ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬");
  }

  function addProduct(){
    const name=prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:"); if(!name) return;
    const sku=prompt("SKU:"); if(!sku) return;
    const buy=Number(prompt("Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:",0));
    const sell=Number(prompt("Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹:",0));
    const qty=Number(prompt("Ø§Ù„ÙƒÙ…ÙŠØ©:",0));
    const low=Number(prompt("Ø­Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:",5));
    S.products.push({id:Date.now(),name,sku,buy,sell,qty,low});
    save();renderProds();toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
  }

  function addCustomer(){
    const name=prompt("Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:"); if(!name) return;
    const phone=prompt("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:");
    S.customers.push({id:Date.now(),name,phone});
    save();renderCusts();toast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„");
  }

  function init(){
    load();
    if(S.user){
      $("#userInfo").textContent="Ù…Ø±Ø­Ø¨Ø§Ù‹ "+S.user.name;
      showView("dashboard");
    } else {
      showView("login");
    }

    $("#menu").addEventListener("click", (e)=>{
      const b=e.target.closest("button[data-v]");
      if(!b) return;
      if(!S.user && b.dataset.v!=="login") return toast("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹",true);
      showView(b.dataset.v);
    });

    $("#loginBtn").addEventListener("click", login);
    $("#logoutBtn").addEventListener("click", logout);
    $("#addProdBtn").addEventListener("click", addProduct);
    $("#addCustBtn").addEventListener("click", addCustomer);
    $("#addToCartBtn").addEventListener("click", addToCart);
    $("#scanCode").addEventListener("keydown",(e)=>{if(e.key==="Enter") addToCart()});
    $("#clearCartBtn").addEventListener("click", ()=>{S.cart=[];save();renderCart();toast("ØªÙ… Ø§Ù„ØªÙØ±ÙŠØº")});
    $("#confirmSaleBtn").addEventListener("click", confirmSale);
    $("#unlockAnalyticsBtn").addEventListener("click", unlockAnalytics);
    $("#analyticsCode").addEventListener("keydown",(e)=>{if(e.key==="Enter") unlockAnalytics()});
    $("#resetBtn").addEventListener("click", ()=>{if(confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")){localStorage.removeItem(KEY);location.reload()}});

    $("#periodBtns").addEventListener("click",(e)=>{
      const b=e.target.closest("button[data-period]");
      if(!b) return;
      $$("#periodBtns button").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      analyticsDays = Number(b.dataset.period) || 7;
      if(!$("#analyticsContent").classList.contains("hidden")) renderAnalytics();
    });

    window.addEventListener("resize", ()=>{
      if($("#v-analytics").classList.contains("active") && !$("#analyticsContent").classList.contains("hidden")){
        renderAnalytics();
      }
    });
  }

  if(document.readyState==="loading") document.addEventListener("DOMContentLoaded", init);
  else init();
})();
</script>

</body>
</html>