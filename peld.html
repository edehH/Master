<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠ</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,sans-serif;background:#0a0a1a;color:#fff;min-height:100vh}
    
    /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø¬ÙˆØ§Ù„ */
    .mobile-header {
      display: none;
      background: #1a1a2e;
      padding: 15px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      position: sticky;
      top: 0;
      z-index: 1001;
      justify-content: space-between;
      align-items: center;
    }
    .menu-toggle {
      background: none;
      border: none;
      color: #0ff;
      font-size: 24px;
      cursor: pointer;
    }

    .app{display:flex;min-height:100vh}
    
    /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± Ù„ÙŠÙƒÙˆÙ† Ù…ØªÙˆØ§ÙÙ‚Ø§Ù‹ Ù…Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„ */
    .sidebar{
      width:280px;
      background: #111122;
      border-left:1px solid rgba(255,255,255,.1);
      padding:20px;
      position:fixed;
      height:100vh;
      overflow-y:auto;
      z-index: 1000;
      transition: transform 0.3s ease;
    }
    
    .main{flex:1;margin-right:280px;padding:20px; transition: margin 0.3s ease;}

    .logo{font-size:22px;font-weight:900;margin-bottom:20px;color:#0ff}
    .menu{display:flex;flex-direction:column;gap:8px}
    .menu button{width:100%;padding:14px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:#fff;border-radius:10px;cursor:pointer;font-size:14px;font-weight:700;text-align:right;transition:.2s}
    .menu button:hover{background:rgba(255,255,255,.08);transform:translateY(-2px)}
    .menu button.active{background:linear-gradient(135deg,rgba(0,255,255,.15),rgba(139,92,255,.15));border-color:#0ff}
    
    .card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:20px;margin-bottom:16px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .grid2, .grid3, .grid4 {display:grid; gap:12px; margin-bottom: 16px;}
    .grid2{grid-template-columns: 1fr 1fr;}
    .grid3{grid-template-columns: 1fr 1fr 1fr;}
    .grid4{grid-template-columns: repeat(4, 1fr);}

    /* Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø±Ù†Ø© */
    .table-responsive { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    table{width:100%;border-collapse:collapse; min-width: 600px;}
    th,td{padding:12px;text-align:right;border-bottom:1px solid rgba(255,255,255,.08)}

    input,select{width:100%;padding:12px;border:1px solid rgba(255,255,255,.15);background:rgba(0,0,0,.3);color:#fff;border-radius:8px;font-size:14px}
    .btn{padding:12px 20px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.05);color:#fff;border-radius:8px;cursor:pointer;font-weight:700;transition:.2s}
    .btn.primary{background:linear-gradient(135deg,#8b5cf6,#0ff);border:none}
    .btn.warning{background:#f90;border:none;color:#000}
    .btn.danger{background:#f43f5e;border:none}
    .btn.sm{padding:8px 14px;font-size:12px}

    .view{display:none}
    .view.active{display:block}
    .stat .num{font-size:32px;font-weight:900;color:#0ff}

    /* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ (Media Queries) */
    @media (max-width: 768px) {
      .mobile-header { display: flex; }
      .sidebar { transform: translateX(100%); width: 260px; }
      .sidebar.open { transform: translateX(0); }
      .main { margin-right: 0; padding: 15px; }
      .grid2, .grid3, .grid4 { grid-template-columns: 1fr; }
      .modal { width: 95%; padding: 15px; }
    }

    /* Ø§Ù„ØªÙˆØ³Øª ÙˆØ§Ù„Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ */
    .toast-box{position:fixed;bottom:20px;left:20px;right:20px;z-index:9999;pointer-events:none}
    .toast{background:#22c55e;color:#fff;padding:14px;border-radius:10px;margin-top:8px;font-weight:700}
    .hidden{display:none!important}
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:9998;padding:10px}
    .modal{background:#1a1a2e;border-radius:16px;padding:20px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto}
  </style>
</head>
<body>

<div class="toast-box" id="toasts"></div>

<div class="mobile-header">
  <div class="logo" style="margin-bottom:0; font-size: 18px;">ğŸª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠ</div>
  <button class="menu-toggle" id="btnToggle">â˜°</button>
</div>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="logo">ğŸª Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
    <nav class="menu" id="menu">
      <button data-v="dashboard" class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button data-v="products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
      <button data-v="customers">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
      <button data-v="scan">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</button>
      <button data-v="debts">Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</button>
      <button data-v="invoices">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
      <button data-v="analytics">ğŸ”’ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø´Ø§Ø·</button>
      <button data-v="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </nav>
    <div style="margin-top:auto;padding-top:20px;border-top:1px solid rgba(255,255,255,.1)">
      <div id="userInfo" style="font-size:12px;color:rgba(255,255,255,.5);margin-bottom:10px">ØºÙŠØ± Ù…Ø³Ø¬Ù„</div>
      <button class="btn sm" style="width:100%" id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
    </div>
  </aside>

  <main class="main">
    <div class="view active" id="v-login">
      <div class="card" style="max-width:400px;margin:60px auto">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <input id="inUser" value="admin" style="margin-bottom:10px" placeholder="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input id="inPass" type="password" value="admin123" style="margin-bottom:10px" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn primary" id="loginBtn" style="width:100%">Ø¯Ø®ÙˆÙ„</button>
      </div>
    </div>

    <div class="view" id="v-dashboard">
      <h2>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
      <div class="grid2">
        <div class="card stat"><div class="num" id="dSales">0</div><div>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div></div>
        <div class="card stat"><div class="num" id="dCount">0</div><div>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div></div>
      </div>
      <div class="card stat"><div class="num" id="dLow">0</div><div>Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø©</div></div>
    </div>

    <div class="view" id="v-products">
      <div class="row" style="justify-content:space-between; margin-bottom:15px">
        <h2 style="margin:0">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
        <button class="btn primary sm" id="addProdBtn">+ Ø¥Ø¶Ø§ÙØ©</button>
      </div>
      <div class="card table-responsive">
        <table>
          <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>SKU</th><th>Ø¨ÙŠØ¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
          <tbody id="prodTable"></tbody>
        </table>
      </div>
    </div>

    <div class="view" id="v-scan">
      <h2>Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h2>
      <div class="grid2">
        <div class="card">
          <label>ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
          <input id="scanCode" placeholder="SKU / QR">
          <label style="margin-top:10px">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
          <select id="payMethod">
            <option value="cash">ÙƒØ§Ø´</option>
            <option value="debt">Ø¯ÙŠÙ† (Ù…Ø¤Ø¬Ù„)</option>
            <option value="bankily">Ø¨Ù†ÙƒÙŠÙ„ÙŠ</option>
          </select>
          <label style="margin-top:10px">Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
          <select id="custSelect"><option value="">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option></select>
          <button class="btn primary" id="addToCartBtn" style="width:100%;margin-top:15px">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        </div>
        <div class="card">
          <h3>Ø§Ù„Ø³Ù„Ø©</h3>
          <div id="cartItems"></div>
          <div style="font-size:22px; font-weight:900; margin-top:10px">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cartTotal">0.00</span></div>
          <button class="btn primary" id="confirmSaleBtn" style="width:100%;margin-top:10px">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹</button>
        </div>
      </div>
    </div>

    <div class="view" id="v-debts">
      <h2>Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</h2>
      <div class="card table-responsive">
        <table>
          <thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
          <tbody id="debtTable"></tbody>
        </table>
      </div>
    </div>

    <div class="view" id="v-analytics">
        <h2>ğŸ”’ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø´Ø§Ø·</h2>
        <div id="analyticsLock" class="card" style="text-align:center">
            <input id="analyticsCode" type="password" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙˆØ±" style="max-width:200px; text-align:center; font-size:20px">
            <button class="btn primary" id="unlockAnalyticsBtn" style="margin-top:10px">ÙØªØ­</button>
        </div>
        <div id="analyticsContent" class="hidden">
            <div class="grid4">
                <div class="card" style="text-align:center"><div>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div><div class="num" id="aProfit" style="color:#22c55e">0</div></div>
                <div class="card" style="text-align:center"><div>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div><div class="num" id="aSales">0</div></div>
            </div>
            <div class="card"><canvas id="analyticsChart"></canvas></div>
        </div>
    </div>

    <div class="view" id="v-settings">
      <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
      <button class="btn danger" id="resetBtn">Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>

  </main>
</div>

<script>
// Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
(function(){
  const KEY = "pos_data_v5";
  let S = {user:null, products:[], customers:[], invoices:[], debts:[], cart:[]};

  const $=s=>document.querySelector(s);
  const $$=s=>document.querySelectorAll(s);

  function save(){ localStorage.setItem(KEY, JSON.stringify(S)); }
  function load(){ const d=JSON.parse(localStorage.getItem(KEY)); if(d) S=d; }

  function toast(m){
    const t=document.createElement("div"); t.className="toast"; t.textContent=m;
    $("#toasts").appendChild(t); setTimeout(()=>t.remove(),2500);
  }

  // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± Ù„Ù„Ø¬ÙˆØ§Ù„
  $("#btnToggle").onclick = () => $("#sidebar").classList.toggle("open");

  function showView(v){
    $$(".view").forEach(el=>el.classList.remove("active"));
    $("#v-"+v).classList.add("active");
    $$(".menu button").forEach(b=>b.classList.toggle("active", b.dataset.v===v));
    $("#sidebar").classList.remove("open"); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
    
    if(v==="dashboard") renderDash();
    if(v==="products") renderProds();
    if(v==="debts") renderDebts();
    if(v==="scan") renderScan();
  }

  // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø±Ø¶ (Render) ---
  function renderProds(){
    $("#prodTable").innerHTML = S.products.map(p=>`<tr>
      <td>${p.name}</td><td>${p.sku}</td><td>${p.sell}</td><td>${p.qty}</td>
      <td class="row">
        <button class="btn sm warning" onclick="editProd(${p.id})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn sm danger" onclick="deleteProd(${p.id})">Ø­Ø°Ù</button>
      </td>
    </tr>`).join("");
  }

  function renderDebts(){
    $("#debtTable").innerHTML = S.debts.map(d=>`<tr>
      <td>${d.cust}</td><td>${d.amount}</td><td>${d.remaining}</td>
      <td><button class="btn sm warning" onclick="editDebt(${d.id})">ØªØ¹Ø¯ÙŠÙ„</button></td>
    </tr>`).join("");
  }

  function renderScan(){
    $("#custSelect").innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>' + S.customers.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
    renderCart();
  }

  function renderCart(){
    $("#cartItems").innerHTML = S.cart.map((it,i)=>`<div style="display:flex; justify-content:space-between; padding:10px; background:rgba(0,0,0,.2); margin-bottom:5px; border-radius:8px">
      <span>${it.name} (${it.qty})</span>
      <button class="btn sm danger" onclick="removeFromCart(${i})">X</button>
    </div>`).join("") || "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©";
    $("#cartTotal").textContent = S.cart.reduce((s,it)=>s+(it.qty*it.sell), 0).toFixed(2);
  }

  // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù ---
  window.editProd = (id) => {
    const p = S.products.find(x=>x.id===id);
    const n = prompt("Ø§Ù„Ø§Ø³Ù…:", p.name);
    if(n){ p.name=n; p.sell=Number(prompt("Ø§Ù„Ø³Ø¹Ø±:", p.sell)); p.qty=Number(prompt("Ø§Ù„ÙƒÙ…ÙŠØ©:", p.qty)); save(); renderProds(); toast("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«"); }
  };
  window.deleteProd = (id) => { if(confirm("Ø­Ø°ÙØŸ")){ S.products=S.products.filter(x=>x.id!==id); save(); renderProds(); }};
  
  window.removeFromCart = (i) => { S.cart.splice(i,1); renderCart(); };

  // --- Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
  $("#loginBtn").onclick = () => { S.user="admin"; $("#userInfo").textContent="Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£Ø¯Ù…Ù†"; save(); showView("dashboard"); };
  $("#menu").onclick = (e) => { if(e.target.dataset.v) showView(e.target.dataset.v); };
  $("#addProdBtn").onclick = () => {
    const n=prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:"); const sk=prompt("Ø§Ù„ÙƒÙˆØ¯:"); const sl=prompt("Ø§Ù„Ø³Ø¹Ø±:"); const q=prompt("Ø§Ù„ÙƒÙ…ÙŠØ©:");
    if(n){ S.products.push({id:Date.now(), name:n, sku:sk, sell:Number(sl), qty:Number(q)}); save(); renderProds(); }
  };
  $("#unlockAnalyticsBtn").onclick = () => { if($("#analyticsCode").value==="2220"){ $("#analyticsLock").classList.add("hidden"); $("#analyticsContent").classList.remove("hidden"); } else { toast("Ø®Ø·Ø£!"); } };
  
  $("#resetBtn").onclick = () => { if(confirm("Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡!")){ localStorage.clear(); location.reload(); }};

  load();
  if(S.user) showView("dashboard"); else showView("login");

})();
</script>
</body>
</html>